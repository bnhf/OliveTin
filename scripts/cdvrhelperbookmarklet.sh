#!/bin/bash

set -x

bookmarkBar=$1

if [[ $bookmarkBar == 1 ]]; then
  echo "Select the javascript line below and drag it to your browser's toolbar."
  echo "Drop it there, then right-click to change its name to CDVR Sources Helper"
  echo

  echo "javascript:(function()%7B(async()%3D%3E%7Bconst%20e%3D%22channels-helper-commands%22%2Cn%3D%22.modal-dialog%22%2Co%3D%22.modal-body%20%3E%20.card%22%2Ct%3D%22.list-group-item%3Anot(.d-none)%22%2Ca%3D%7Btoolbar%3A%60%24%7Bo%7D%20%3E%20.card-header%60%2CchannelRow%3A%60%24%7Bo%7D%20%3E%20%24%7B%22.list-group%22%7D%20%3E%20%24%7B%22.list-group-item%22%7D%60%2CchannelContent%3A%22.row%20%3E%20.col-sm-6%20%3E%20span%22%2Cfavorites%3A%60%24%7Bo%7D%20%24%7Bt%7D%20%5Baria-label%3D%22favorited%22%5D%3E.glyphicon-heart%60%2CallFavorites%3A%60%24%7Bo%7D%20%5Baria-label%3D%22favorited%22%5D%3E.glyphicon-heart%60%2Cunfavorites%3A%60%24%7Bo%7D%20%24%7Bt%7D%20%5Baria-label%3D%22not%20favorited%22%5D%3E.glyphicon-heart-empty%60%2CallUnfavorites%3A%60%24%7Bo%7D%20%5Baria-label%3D%22not%20favorited%22%5D%3E.glyphicon-heart-empty%60%2Cblocked%3A%60%24%7Bo%7D%20%24%7Bt%7D%20%5Baria-label%3D%22hidden%22%5D%3E.glyphicon-ban-circle%60%2CallBlocked%3A%60%24%7Bo%7D%20%5Baria-label%3D%22hidden%22%5D%3E.glyphicon-ban-circle%60%2Cunblocked%3A%60%24%7Bo%7D%20%24%7Bt%7D%20%5Baria-label%3D%22not%20hidden%22%5D%3E.glyphicon-ban-circle%60%2CallUnblocked%3A%60%24%7Bo%7D%20%5Baria-label%3D%22not%20hidden%22%5D%3E.glyphicon-ban-circle%60%7D%3Bfunction%20r()%7Breturn%20document.querySelectorAll(a.channelRow)%7Dfunction%20l(e)%7Breturn%20function()%7Bu(!0)%3Bconst%20n%3Dr()%2Co%3DArray.from(n)%3Bo.sort(e)%3Bconst%20t%3Dn%5B0%5D.parentNode%2Ca%3Dt.parentNode%3Ba.removeChild(t)%2Ct.innerHTML%3D%22%22%3Bconst%20l%3Ddocument.createDocumentFragment()%3Bo.forEach((function(e)%7Bl.appendChild(e)%7D))%2Ct.appendChild(l)%2Ca.appendChild(t)%2Cu(!1)%7D%7Dfunction%20c(e)%7Breturn%20e.querySelector(a.channelContent)%7Dfunction%20i(e)%7Breturn%20c(e).childNodes%5B2%5D.textContent.trim()%7Dfunction%20s(e)%7Breturn%20c(e).childNodes%5B0%5D.textContent.trim()%7Dfunction%20d(e)%7Bconst%20n%3Dc(e)%3Breturn%20n.querySelector(%22.category%22)%3F.textContent.trim()%7Dfunction%20u(e)%7Bdocument.querySelector(%22.spinner-border%22).style.display%3De%3F%22block%22%3A%22none%22%2Cy().disabled%3De%7Dfunction%20h(e)%7Breturn%20function()%7BArray.from(document.querySelectorAll(e)).forEach((function(e%2Cn)%7Bif(n%252%3D%3D0)%7Bconst%20n%3De.closest(a.channelRow)%3Bn.classList.contains(%22d-none%22)%3Fn.classList.remove(%22d-none%22)%3An.classList.add(%22d-none%22)%7D%7D))%7D%7Dfunction%20m(e%2Cn)%7Breturn%20function()%7Bif(n%26%26!confirm(n))return%3Bconst%20o%3DArray.from(document.querySelectorAll(e))%3Blet%20t%3D0%3Bu(!0)%2Cfunction%20e()%7Bt%3Co.length%3F(t%252%3D%3D0%26%26o%5Bt%5D.click()%2Ct%2B%2B%2CsetTimeout(e%2C0))%3Au(!1)%7D()%7D%7Dasync%20function%20f()%7Bconst%20e%3Dr()%3Blet%20n%3D%5B%5D%3Btry%7Bn%3Dawait%20async%20function()%7Btry%7Bconst%20e%3D%22http%3A%2F%2Fapi.pluto.tv%2Fv2%2Fchannels%22%2Cn%3Dawait%20fetch(e)%3Bif(!n.ok)throw%20new%20Error(%22Network%20response%20was%20not%20ok%22)%3Bconst%20o%3Dawait%20n.json()%3Breturn%20o.reduce(((e%2Cn)%3D%3E(n._id%26%26n.name%26%26n.summary%26%26(e%5Bn._id%5D%3D%7Bname%3An.name%2Csummary%3An.summary%7D)%2Ce))%2C%7B%7D)%7Dcatch(e)%7Bconsole.error(%22Problem%20fetching%20pluto%20channels%20listing%3A%22%2Ce)%7D%7D()%3F%3F%5B%5D%7Dcatch(e)%7B%7Dfor(const%20o%20of%20e)%7Bconst%20e%3Ds(o)%2Ct%3Dwindow.DVR.channels%5Be%5D%3F.Categories%3F.toString()%3F%3F%22%22%3Bif(t)%7Bconst%20e%3Ddocument.createElement(%22span%22)%3Be.className%3D%22badge%20badge-primary%20mx-1%20category%22%2Ce.textContent%3Dt%2Cc(o).appendChild(e)%7Dconst%20a%3Dwindow.DVR.channels%5Be%5D%3F.Station%3Blet%20r%3Dwindow.DVR.channels%5Be%5D%3F.Description%3Bif(!r%26%26a%26%26(r%3Dn%5Ba%5D%3F.summary)%2Cr)%7Bconst%20e%3Ddocument.createElement(%22span%22)%3Be.classList.add(%22tooltip-target%22%2C%22glyphicon%22%2C%22glyphicon-info-sign%22%2C%22mx-1%22)%2Ce.title%3Dr%2Cc(o).appendChild(e)%7D%7D%7Dfunction%20y()%7Breturn%20document.querySelector(%60%23%24%7Be%7D%60)%7Dfunction%20p()%7Bconst%20e%3Ddocument.createElement(%22input%22)%3Breturn%20e.id%3D%22channels-helper-filter%22%2Ce.name%3De.id%2Ce.type%3D%22search%22%2Ce.classList.add(%22form-control%22%2C%22form-control-sm%22%2C%22float-right%22%2C%22mr-5%22)%2Ce.style.cssText%3D%22max-width%3A%2015rem%3B%20max-height%3A%201.5rem%3B%22%2Ce.placeholder%3D%22Type%20to%20filter...%22%2Ce.addEventListener(%22input%22%2C(function(e)%7B!function(e)%7Br().forEach((n%3D%3E%7Bn.textContent.toLowerCase().includes(e)%3Fn.classList.remove(%22d-none%22)%3An.classList.add(%22d-none%22)%7D))%7D(e.target.value.toLowerCase())%7D))%2Ce%7Dconst%20w%3D%7Bblock%3Am(a.unblocked%2C%22Are%20you%20sure%20you%20want%20to%20block%20all%20channels%20shown%3F%20This%20may%20take%20a%20minute...%22)%2Cunblock%3Am(a.blocked%2C%22Are%20you%20sure%20you%20want%20to%20unblock%20all%20channels%20shown%3F%20This%20may%20take%20a%20minute...%22)%2CshowHideBlocked%3Ah(a.allBlocked)%2CshowHideUnblocked%3Ah(a.allUnblocked)%2Cfavorite%3Am(a.unfavorites%2C%22Are%20you%20sure%20you%20want%20to%20favorite%20all%20channels%20shown%3F%20This%20may%20take%20a%20minute...%22)%2Cunfavorite%3Am(a.favorites%2C%22Are%20you%20sure%20you%20want%20to%20unfavorite%20all%20channels%20shown%3F%20This%20may%20take%20a%20minute...%22)%2CshowHideFavorites%3Ah(a.allFavorites)%2CshowHideUnfavorites%3Ah(a.allUnfavorites)%2CsortByCategoryThenChannelName%3Al((function(e%2Cn)%7Bconst%20o%3Dd(e)%3F.toLowerCase()%3F%3F%22%22%2Ct%3Dd(n)%3F.toLowerCase()%3F%3F%22%22%2Ca%3Do.localeCompare(t)%3Bif(0!%3D%3Da)return%20a%3Bconst%20r%3Di(e).toLowerCase()%2Cl%3Di(n).toLowerCase()%3Breturn%20r.localeCompare(l)%7D))%2CsortByCategoryThenChannelNumber%3Al((function(e%2Cn)%7Bconst%20o%3Dd(e)%3F.toLowerCase()%3F%3F%22%22%2Ct%3Dd(n)%3F.toLowerCase()%3F%3F%22%22%2Ca%3Do.localeCompare(t)%3Bif(0!%3D%3Da)return%20a%3Bconst%20r%3Ds(e)%2Cl%3Ds(n)%3Breturn%20r.localeCompare(l%2C%22en%22%2C%7Bnumeric%3A!0%7D)%7D))%2CsortByChannelName%3Al((function(e%2Cn)%7Bconst%20o%3Di(e).toLowerCase()%2Ct%3Di(n).toLowerCase()%3Breturn%20o.localeCompare(t)%7D))%2CsortByChannelNumber%3Al((function(e%2Cn)%7Bconst%20o%3Ds(e)%2Ct%3Ds(n)%3Breturn%20o.localeCompare(t%2C%22en%22%2C%7Bnumeric%3A!0%7D)%7D))%2CshowThemAll%3Afunction()%7BArray.from(document.querySelectorAll(a.channelRow)).forEach((function(e%2Cn)%7Be.classList.contains(%22d-none%22)%26%26e.classList.remove(%22d-none%22)%7D))%7D%2Cinit%3Aasync%20function()%7Bdocument.querySelector(n).style.cssText%3D%22max-width%3A%201000px%3B%22%3Bconst%20o%3Dfunction()%7Bconst%20e%3Ddocument.createElement(%22div%22)%3Breturn%20e.classList.add(%22spinner-border%22%2C%22spinner-border-sm%22%2C%22float-right%22)%2Ce.style.cssText%3D%22margin-right%3A%20.5rem%3B%20margin-top%3A%20.2rem%3B%20display%3A%20none%3B%22%2Ce%7D()%2Ct%3Dp()%2Cr%3Dfunction()%7Bconst%20n%3D%7B%22%22%3A%22Select%20a%20command...%22%2Cblock%3A%22Block%20Channels%22%2Cunblock%3A%22Unblock%20Channels%22%2CshowHideBlocked%3A%22Show%2FHide%20Blocked%20Channels%22%2CshowHideUnblocked%3A%22Show%2FHide%20Unblocked%20Channels%22%2Cfavorite%3A%22Favorite%20Channels%22%2Cunfavorite%3A%22Unfavorite%20Channels%22%2CshowHideFavorites%3A%22Show%2FHide%20Favorites%22%2CshowHideUnfavorites%3A%22Show%2FHide%20Unfavorites%22%2CsortByCategoryThenChannelName%3A%22Sort%20by%20Category%20then%20Channel%20Name%22%2CsortByCategoryThenChannelNumber%3A%22Sort%20by%20Category%20then%20Channel%20Number%22%2CsortByChannelName%3A%22Sort%20by%20Channel%20Name%22%2CsortByChannelNumber%3A%22Sort%20by%20Channel%20Number%22%2CshowThemAll%3A%22Show%20all%20Channels%22%7D%2Co%3Ddocument.createElement(%22select%22)%3Bfor(var%20t%20in%20o.id%3De%2Co.name%3Do.id%2Co.classList.add(%22form-control%22%2C%22form-control-sm%22%2C%22float-right%22%2C%22py-0%22)%2Co.style.cssText%3D%22max-width%3A%2015rem%3B%20max-height%3A%201.5rem%3B%22%2Co.addEventListener(%22change%22%2C(function()%7Bconst%20e%3Dthis.value%3Be%26%26w%5Be%5D%26%26(w%5Be%5D()%2Cthis.value%3D%22%22)%7D))%2Cn)%7Bconst%20e%3Ddocument.createElement(%22option%22)%3Be.value%3Dt%2Ce.text%3Dn%5Bt%5D%2Co.appendChild(e)%7Dreturn%20o%7D()%2Cl%3Ddocument.querySelector(a.toolbar)%3Bl%26%26!y()%26%26(l.append(r)%2Cl.append(o)%2Cl.append(t))%2Cu(!0)%2Cawait%20f()%2Cu(!1)%7D%7D%3Bawait%20w.init()%7D)()%3B%7D)()%3B"
  echo
else
  cat /config/cdvrhelperbookmarklet.js
fi
